<!DOCTYPE html>
<html lang="en">
<head>
  <!-- all your head content stays exactly the same -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Our Stock - Live View</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#3b6dc6" />
  <link rel="apple-touch-icon" href="inventory192.png" />
  <style>
   body {
  background: #f9f9f9;
  margin: 0;
  padding: 0 0 100px 0; /* generous bottom padding so button is never cut off */
  min-height: 100vh;
  box-sizing: border-box;
}

/* Main heading */
h1 {
  text-align: center;
  color: #3b6dc6;
  margin: 30px 0;
  font-size: 24px;
}

/* Owner button — sits at the bottom of the page, scrolls normally */
#studio-toggle-btn {
  display: block;
  margin: 40px auto 0;           /* auto centers it, 40px space from last product */
  padding: 10px 20px;            /* comfortable padding */
  background: rgba(59, 109, 198, 0.15);
  color: #3b6dc6;
  font-size: 14px;
  font-weight: 600;
  border: 1px solid #3b6dc6;
  border-radius: 50px;           /* perfect pill shape */
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  white-space: nowrap;           /* prevents text from wrapping */
  max-width: 90%;                /* safety on very small screens */
  box-sizing: border-box;
}

#studio-toggle-btn:hover {
  background: #3b6dc6;
  color: white;
  transform: scale(1.05);
}

/* Rest of your styles — unchanged and perfect */
.box-container {
  text-align: center;
  margin-top: 20px;
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
}
.box-container.active {
  max-height: 520px;
  opacity: 1;
}
.box {
  background: white;
  padding: 40px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  text-align: center;
  width: 300px;
  margin: 0 auto;
}
input {
  width: 100%;
  padding: 12px;
  margin: 15px 0;
  font-size: 18px;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-sizing: border-box;
}
button {
  width: 100%;
  padding: 14px;
  background: #3b6dc6;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 18px;
  cursor: pointer;
  transition: background 0.2s;
}
button:hover { background: #325a9e; }
.wrong {
  color: red;
  margin-top: 10px;
  display: none;
  font-size: 14px;
}
input:focus {
  outline: none;
  border-color: #3b6dc6;
  box-shadow: 0 0 0 3px rgba(59, 109, 198, 0.2);
}
  </style>
</head>
<body>
  <main class="page">
    <h1>Current Stock</h1>
    <section id="productsContainer" class="products-area">
      <div class="hint">Loading products...</div>
    </section>
  </main>

  <!-- STUDIO BUTTON NOW AT THE VERY BOTTOM — TINY & DISCREET -->
  <button id="studio-toggle-btn" title="Owner only">Owner Access</button>

  <!-- Password box (still hidden until button clicked) -->
  <div id="studio-content" class="box-container">
    <div class="box">
      <h2>Studio Access</h2>
      <input type="password" id="pass" placeholder="Enter password" />
      <button onclick="go()">Enter Studio</button>
      <p class="wrong" id="msg"></p>
    </div>
  </div>





  <!-- PWA Install Button (optional) -->
 <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }

  let deferredPrompt;
  const INSTALL_KEY = "appInstalledOrDismissed"; // Remember user's choice forever

  // Check if user already installed or dismissed
  if (localStorage.getItem(INSTALL_KEY) === "true") {
    // Do nothing — button stays hidden forever
  } else {
    // Create tiny install button at top-right
    const btn = document.createElement("button");
    btn.textContent = "⬇️";              // ← Only a tiny downward arrow
btn.title = "Install App";           // Tooltip explains it on hover/tap
btn.style = `
  position:fixed;
  top:12px;
  right:12px;
  background:#3b6dc6;
  color:white;
  border:none;
  width:36px;           /* fixed small size */
  height:36px;
  font-size:18px;       /* makes the ↓ nice and clear */
  line-height:36px;     /* vertically centers the arrow */
  border-radius:50%;    /* perfect circle */
  cursor:pointer;
  z-index:9999;
  box-shadow:0 2px 8px rgba(0,0,0,0.25);
  transition:all 0.2s ease;
  display:none;
  text-align:center;
`;
    btn.onmouseover = () => btn.style.transform = "scale(1.1)";
    btn.onmouseout  = () => btn.style.transform = "scale(1)";

    document.body.appendChild(btn);

    window.addEventListener("beforeinstallprompt", e => {
      e.preventDefault();
      deferredPrompt = e;
      btn.style.display = "block"; // Show only when installable
    });

    btn.onclick = () => {
      btn.style.display = "none";
      localStorage.setItem(INSTALL_KEY, "true"); // Never show again

      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(choice => {
          if (choice.outcome === "accepted") {
            console.log("App installed");
          } else {
            console.log("Install declined");
          }
          deferredPrompt = null;
        });
      }
    };

    // Optional: Also hide forever if user clicks outside (dismisses prompt)
    window.addEventListener("appinstalled", () => {
      localStorage.setItem(INSTALL_KEY, "true");
    });
  }
</script>

<script>
    const PASSWORD = "12345";
    const AUTH_KEY = "studioAuthenticated";
    const BAN_KEY = "studioAccessBanned";
    const UNBAN_CODE = "LIFTBAN";

    let successfulLogins = parseInt(localStorage.getItem('studioSuccessCount') || '0', 10);
    let failedLogins = parseInt(localStorage.getItem('studioFailedCount') || '0', 10);

    const toggleBtn = document.getElementById('studio-toggle-btn');
    const content = document.getElementById('studio-content');

    // Secret URL backdoor: ?admin → force open password box (for unban)
    if (location.search === "?admin") {
      content.classList.add('active');
      history.replaceState(null, null, location.pathname); // hide ?admin from URL
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem(BAN_KEY) === 'true') {
        toggleBtn.remove(); // completely gone for banned users
        return;
      }
      if (localStorage.getItem(AUTH_KEY) === 'true') {
        toggleBtn.textContent = "Studio (Direct)";
        toggleBtn.onclick = () => location.href = "studio.html";
        content.remove();
      }
    });

    toggleBtn.addEventListener('click', () => {
      if (localStorage.getItem(AUTH_KEY) === 'true') {
        location.href = "studio.html";
      } else {
        content.classList.toggle('active');
      }
    });

    function go() {
      const input = document.getElementById('pass').value.trim();
      const msg = document.getElementById('msg');

      if (input === UNBAN_CODE) {
        localStorage.removeItem(BAN_KEY);
        localStorage.setItem('studioFailedCount', '0');
        location.reload(); // brings button back
        return;
      }

      if (input === PASSWORD) {
        successfulLogins++;
        localStorage.setItem('studioSuccessCount', successfulLogins);
        localStorage.setItem('studioFailedCount', '0');

        if (successfulLogins >= 2) {
          localStorage.setItem(AUTH_KEY, 'true');
          toggleBtn.textContent = "Studio (Direct)";
          content.remove();
        }
        setTimeout(() => location.href = "studio.html", 150);
        return;
      }

      // Wrong → 2 fails = button vanishes forever
      failedLogins++;
      localStorage.setItem('studioFailedCount', failedLogins);
      localStorage.setItem('studioSuccessCount', '0');

      if (failedLogins >= 2) {
        localStorage.setItem(BAN_KEY, 'true');
        msg.textContent = "Access banned permanently.";
        msg.style.color = "red";
        content.classList.remove('active');
        toggleBtn.remove(); // GONE. No temptation.
      } else {
        msg.textContent = `Wrong! ${2 - failedLogins} attempt(s) left.`;
        msg.style.color = "red";
      }
    }

    document.getElementById('pass')?.addEventListener('keypress', e => e.key === 'Enter' && go());
  </script>

  <script src="index.js" defer></script>
</body>
</html>
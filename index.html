<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kona Mart | Find Business Products</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#3b6dc6" />
    <link rel="apple-touch-icon" href="inventory192.png" />
    
    <meta property="og:title" content="Kona Mart: Find Local Businesses & Products">
    <meta property="og:url" content="https://vibe-ultrafiles04.github.io/Kona-Mart/index.html">
    <meta property="og:description" content="Search local business profiles, compare products, and connect instantly via chat!">
    <meta property="og:image" content="https://raw.githubusercontent.com/Vibe-Ultrafiles04/Uchumi-Chat/main/Kona101.png">
    <meta property="og:type" content="website">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/Vibe-Ultrafiles04/Uchumi-Chat/main/Kona101.png">

    <style>
        body {
            background: #f9f9f9;
            margin: 0;
            padding: 0 0 100px 0;
            min-height: 100vh;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        h1 {
            text-align: center;
            color: #3b6dc6;
            margin: 30px 0;
            font-size: 24px;
        }

        /* Profile Header */
        #profileHeader {
            text-align: center;
            padding: 15px;
            background: #e9f0fa;
            border-bottom: 2px solid #3b6dc6;
            margin-bottom: 20px;
            display: none;
        }

        #ownerBusinessNameDisplay {
            font-size: 18px;
            font-weight: bold;
            color: #3b6dc6;
            margin-bottom: 8px;
        }

        #editProfileBtn, #logoutBtn {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.2s;
        }

        #editProfileBtn:hover, #logoutBtn:hover {
            background: #e0e0e0;
        }

        /* Filter Bar */
        .filter-bar {
            text-align: center;
            margin: 20px auto;
            max-width: 90%;
        }

        .filter-bar label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #444;
        }

        .filter-bar input {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
        }

        /* My Studio Button */
        #myStudioBtn {
            display: none;
            margin: 5px auto 0;
            padding: 14px 32px;
            background: #3b6dc6;
            color: white;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(59, 109, 198, 0.3);
            transition: all 0.3s ease;
        }

        #myStudioBtn:hover {
            background: #325a9e;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 109, 198, 0.4);
        }

        #shareAppBtn {
    /* Use small button sizing */
    background: #463dc5; /* Green */
    color: white;
    border: 1px solid #218838;
    padding: 6px 12px;
    font-size: 12px;
    border-radius: 4px;
    cursor: pointer;
    margin: 5px;
    transition: background 0.2s;
}

#shareAppBtn:hover {
    background: #218838;
}
    </style>
</head>
<body>

    <!-- Profile Header Section -->
    <section id="profileHeader">
        <div id="ownerBusinessNameDisplay">Loading profile...</div>
       <div>
            <button id="shareAppBtn">Share App Link</button> 
            <button id="editProfileBtn">Edit Profile</button>
            <button id="logoutBtn">Logout</button>
        </div>
    </section>

    <!-- Main Content -->
    <main class="page">
         <!-- My Studio Button (Only visible to owner) -->
  <button id="myStudioBtn">My Studio</button>
       
    <h1>#ADVERT #CHONJO #UNAWEZA #JITUMA</h1>
         
        <div class="filter-bar">
            <label for="businessFilterInput">Search Business:</label>
            <input type="text" id="businessFilterInput" placeholder="Type the business name...">
        </div>

        <section id="productsContainer" class="products-area">
            <div class="hint">Loading products...</div>
        </section>
    </main>

   

    <!-- Service Worker & PWA Install Button -->
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service-worker.js");
        }

        let deferredPrompt;
        const INSTALL_KEY = "appInstalledOrDismissed";

        if (localStorage.getItem(INSTALL_KEY) !== "true") {
            const btn = document.createElement("button");
            btn.textContent = "⬇️";
            btn.title = "Install App";
            btn.style = `
                position:fixed;top:12px;right:12px;background:#3b6dc6;color:white;border:none;
                width:36px;height:36px;font-size:18px;line-height:36px;border-radius:50%;
                cursor:pointer;z-index:9999;box-shadow:0 2px 8px rgba(0,0,0,0.25);
                transition:all 0.2s ease;display:none;text-align:center;
            `;
            btn.onmouseover = () => btn.style.transform = "scale(1.1)";
            btn.onmouseout  = () => btn.style.transform = "scale(1)";
            document.body.appendChild(btn);

            window.addEventListener("beforeinstallprompt", e => {
                e.preventDefault();
                deferredPrompt = e;
                btn.style.display = "block";
            });

            btn.onclick = () => {
                btn.style.display = "none";
                localStorage.setItem(INSTALL_KEY, "true");
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then(() => { deferredPrompt = null; });
                }
            };

            window.addEventListener("appinstalled", () => {
                localStorage.setItem(INSTALL_KEY, "true");
            });
        }
    </script>

    <!-- Business Profile & One-Click "Start New Business" Button -->
<script>
    const DEVICE_ID_KEY = 'uniqueDeviceId';
    const OWNER_BUSINESS_KEY = 'ownerBusinessName';

    const profileHeader = document.getElementById('profileHeader');
    const ownerBusinessNameDisplay = document.getElementById('ownerBusinessNameDisplay');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const myStudioBtn = document.getElementById('myStudioBtn');

    document.addEventListener('DOMContentLoaded', () => {
        const ownerBusinessName = localStorage.getItem(OWNER_BUSINESS_KEY);

        if (ownerBusinessName) {
            // You're logged in as a business owner
            ownerBusinessNameDisplay.textContent = `Active: ${ownerBusinessName}`;
            profileHeader.style.background = "#e3f2fd";
            profileHeader.style.display = 'block';

            // Edit Profile Button
            editProfileBtn.textContent = "Edit Profile";
            editProfileBtn.onclick = () => location.href = 'setup.html?mode=edit';

            // ONE BUTTON TO RULE THEM ALL: "Start New Business"
            logoutBtn.textContent = "Start New Business";
            logoutBtn.style.cssText = `
                background: #ff5252 !important;
                color: white15px;
                font-weight: bold;
                border: none;
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
            `;
            logoutBtn.onclick = () => {
                if (confirm("Start a completely new business?\n\nThis will delete your current profile and device link.\nYou’ll be able to create a fresh one.")) {
                    // FULL CLEAN SLATE
                    localStorage.removeItem(OWNER_BUSINESS_KEY);
                    localStorage.removeItem(DEVICE_ID_KEY);
                    sessionStorage.clear();

                    alert("All clear! Taking you to setup a new business...");
                    location.href = "setup.html";
                }
            };

            // My Studio Button
            myStudioBtn.style.display = "block";
            myStudioBtn.textContent = "My Studio";
            myStudioBtn.onclick = () => {
                sessionStorage.setItem('ownerStudioAccess', ownerBusinessName);
                location.href = "studio.html";
            };

        } else {
            // No profile yet — first-time user
            profileHeader.style.display = 'block';
            ownerBusinessNameDisplay.textContent = "No business yet";
            editProfileBtn.textContent = "Create Your Business";
            editProfileBtn.onclick = () => location.href = 'setup.html';

            logoutBtn.style.display = "none";
            myStudioBtn.style.display = "none";
        }
    });
</script>
<script>
    // ===================================
    // SIMPLIFIED SHARE APP LOGIC (COPY TO CLIPBOARD ONLY)
    // ===================================
    document.addEventListener('DOMContentLoaded', () => {
        
        const shareAppBtn = document.getElementById('shareAppBtn');
        const appLink = "https://vibe-ultrafiles04.github.io/Uchumi-Chat/";
        
        // Ensure the button exists before attaching the listener
        if (!shareAppBtn) return; 

        shareAppBtn.onclick = () => {
            copyToClipboard(appLink);
        };
        
        function copyToClipboard(link) {
            // Use the modern navigator.clipboard API
            navigator.clipboard.writeText(link)
                .then(() => {
                    // Provide user feedback
                    const originalText = shareAppBtn.textContent;
                    shareAppBtn.textContent = "✅ Link Copied!";
                    
                    // Revert the button text after 2 seconds
                    setTimeout(() => { 
                        shareAppBtn.textContent = originalText; 
                    }, 2000);
                })
                .catch(err => {
                    // Fallback alert if clipboard access is denied
                    alert('Could not copy link to clipboard. Please copy manually: ' + link);
                    console.error('Copy failed:', err);
                });
        }
    });
</script>


    <script src="index.js" defer></script>
</body>
</html>
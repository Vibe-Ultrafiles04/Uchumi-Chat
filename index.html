<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#3b6dc6" />
  <title>Smart Inventory</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#3b6dc6" />
<link rel="apple-touch-icon" href="icons/icon-192x192.png" />

</head>
<body>

    <main class="page">
        <button id="toggleFormBtn" class="btn-toggle">Toggle Input Form (Show)</button>

        <section id="productsContainer" class="products-area">
            <div class="hint">OTHER PRODUCT CONTAINERS WILL APPEAR HERE</div>
        </section>

        <div id="inputContainer" style="display: none;">
            <section class="product-panel add-panel">
                <div class="form-row">
                    <div class="label-black">PRODUCT name</div>
                    <input id="productName" class="text-input" type="text" placeholder="Product name appears here" />
                </div>

               <div class="form-row">
    <div class="label-black">Quantity</div>
    <input id="productQuantity" class="text-input" 
        type="text" 
        placeholder="Number of products" 
        min="0"
        data-numeric="true"
    />
</div>

               <div class="form-row">
    <div class="label-black">BUYING PRICE</div>
    <input id="productBuy" class="text-input" 
           type="text" 
           placeholder="Buying price appears here" 
           data-numeric="true"
    />
</div>

<div class="form-row">
    <div class="label-black">SELLING PRICE</div>
    <input id="productSell" class="text-input" 
           type="text" 
           placeholder="Selling price appears here" 
           data-numeric="true"
    />
</div>
                <div class="thumb-and-link">
                    <div id="newThumb" class="thumb-preview small">Thumbnail appears</div>
                    <div class="link-column">
                        <input id="driveLink" class="text-input" type="text" placeholder="Paste your google Drive Link" />
                        <button id="previewBtn" class="btn-black small">Preview</button>
                        <button id="saveLinkBtn" class="btn-black small">Save Link</button>
                    </div>
                </div>

                <div class="add-row">
                    <button id="openGalleryBtn" class="btn-black big">Open Link Gallery</button>
                    <button id="addProductBtn" class="btn-black big">Add product</button>
                </div>
            </section>
        </div>

        <dialog id="linkGalleryDialog">
            <div class="gallery-header">
                <h2>Link Gallery</h2>
                <button id="closeGalleryBtn" class="btn-black small">Close</button>
            </div>
            <section id="galleryContainer" class="products-area"></section>
        </dialog>

    <dialog id="updateDialog" class="modal">
    <div class="modal-body">
        <button id="closeUpdateDialogBtn" class="close-btn">X</button> 
        <p class="product-title">Product: <strong id="updateProductName"></strong></p>
        
        <div class="input-group">
            <label for="sellQuantity">ðŸ“‰ Units Sold (Decrease Stock):</label>
            <input 
                type="text" 
                id="sellQuantity" 
                min="0" 
                value="0" 
                placeholder="Enter quantity sold"
                class="input-field"
                data-numeric="true" >
        </div>
        
        <div class="input-group">
            <label for="restockQuantity">ðŸ“¦ Units Restocked (Increase Stock):</label>
            <input 
                type="text" 
                id="restockQuantity" 
                min="0" 
                value="0" 
                placeholder="Enter quantity restocked"
                class="input-field"
                data-numeric="true" >
        </div>
        
        <button id="executeUpdateButton" class="btn btn-primary">
            Execute Stock Update
        </button>
        
    </div>
</dialog>
        <script>
            // âœ… Register the Service Worker
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker
                    .register("service-worker.js")
                    .then(() => console.log("âœ… Service Worker registered successfully."))
                    .catch((err) => console.error("âŒ Service Worker registration failed:", err));
            }

            // âœ… Handle PWA Install Prompt
            let deferredPrompt;
            const installBtn = document.createElement("button");
            installBtn.textContent = "ðŸ“² Install App";
            installBtn.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #3b6dc6;
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 10px;
                font-size: 16px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                cursor: pointer;
                display: none;
                z-index: 9999;
            `;
            document.body.appendChild(installBtn);

            window.addEventListener("beforeinstallprompt", (e) => {
                // Prevent the mini-infobar from appearing
                e.preventDefault();
                deferredPrompt = e;

                // Show the install button
                installBtn.style.display = "block";
                console.log("ðŸ“¦ PWA install prompt ready.");

                installBtn.addEventListener("click", async () => {
                    installBtn.style.display = "none";
                    deferredPrompt.prompt(); // Show the native prompt

                    const {
                        outcome
                    } = await deferredPrompt.userChoice;
                    console.log(`User response to install: ${outcome}`);

                    deferredPrompt = null;
                });
            });

            // Optional: Notify if app is already installed
            window.addEventListener("appinstalled", () => {
                console.log("âœ… App installed successfully!");
                installBtn.remove();
            });
        </script>

       

        <script>

            document.addEventListener('DOMContentLoaded', () => {
    // Select all inputs you want to format
    const numericInputs = document.querySelectorAll('input[data-numeric="true"]');

    // Function to strip commas and return a pure number string
    const unformatNumber = (value) => {
        // Replace all commas with an empty string
        return value.replace(/,/g, '');
    };

    // Function to format the number with thousands separators (commas)
    const formatNumber = (value) => {
        // First, unformat to ensure only pure numeric value remains
        const rawValue = unformatNumber(value); 
        
        // Ensure the value is treated as a string for regex
        let [integerPart, decimalPart] = rawValue.split('.');
        
        // Add commas to the integer part
        integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ",");

        // Recombine integer and decimal parts
        if (decimalPart !== undefined) {
            return `${integerPart}.${decimalPart}`;
        }
        return integerPart;
    };

    numericInputs.forEach(input => {
        // 1. Format on input (while user is typing)
        input.addEventListener('input', (event) => {
            const cursorStart = event.target.selectionStart;
            const originalLength = event.target.value.length;

            const unformatted = unformatNumber(event.target.value);
            const formatted = formatNumber(unformatted);
            
            event.target.value = formatted;

            // Maintain cursor position after formatting
            const newLength = event.target.value.length;
            const newCursor = cursorStart + (newLength - originalLength);
            event.target.setSelectionRange(newCursor, newCursor);
        });

        // 2. Format on blur (when user clicks away)
        input.addEventListener('blur', (event) => {
            event.target.value = formatNumber(event.target.value);
        });
        
        // 3. Optional: Unformat before form submission (if required)
        // If you are submitting the form, you must unformat the value 
        // back to a standard number (no commas) before sending it to the server.
    });
});
    document.addEventListener('DOMContentLoaded', () => {
        const toggleBtn = document.getElementById('toggleFormBtn');
        const inputContainer = document.getElementById('inputContainer');
        const content = inputContainer.querySelector('.product-panel.add-panel');
        
        // 1. Set initial state for smooth toggle (Hidden by default)
        // inputContainer must be styled with overflow: hidden; and max-height: 0;
        inputContainer.style.maxHeight = '0';
        inputContainer.style.opacity = '0';
        // Ensure it's not display: none, or transition won't work
        inputContainer.style.display = 'block'; 

        // Set initial button text to 'Show'
        toggleBtn.textContent = 'Toggle Input Form (Show)';

        toggleBtn.addEventListener('click', () => {
            // Check if the container is visually hidden (max-height is 0)
            const isHidden = inputContainer.style.maxHeight === '0px';

            if (isHidden) {
                // SHOW: Temporarily set max-height to its content height (plus a buffer)
                // This forces the transition from 0 to the actual height.
                const scrollHeight = content.scrollHeight; 
                inputContainer.style.maxHeight = scrollHeight + 40 + 'px'; // + buffer for padding/margin
                inputContainer.style.opacity = '1';
                toggleBtn.textContent = 'Toggle Input Form (Hide)';

            } else {
                // HIDE: First set max-height to its current scrollHeight, 
                // then set it to 0 after a tiny delay. This ensures the transition works.
                // We also set the max-height to 0 directly, as it's the target.
                inputContainer.style.maxHeight = '0';
                inputContainer.style.opacity = '0';
                toggleBtn.textContent = 'Toggle Input Form (Show)';
            }
        });
    });
</script>

        <script src="script.js" defer></script>

    </main>
</body>
</html>
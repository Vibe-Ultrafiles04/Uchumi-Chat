<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Our Stock - Live View</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#3b6dc6" />
  <link rel="apple-touch-icon" href="icons/icon-192x192.png" />
  <style>
   body { background: #f9f9f9; }

/* The main heading is still centered */
h1 { text-align:center; color:#3b6dc6; margin:30px 0; font-size:24px; }

/* Styles for the new "Studio" toggle button */
.toggle-btn {
    padding: 10px 20px;
    background: #3b6dc6;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    display: block; /* Make it a block element to control centering */
    margin: 20px auto 0; /* Center it horizontally and add space */
}

/* Existing CSS for the container */
.box-container {
    text-align: center;
    margin-top: 20px;
    
    /* --- KEY CHANGES FOR SMOOTHNESS --- */
    /* Start with max-height 0 to hide it */
    max-height: 0;
    opacity: 0;
    overflow: hidden; /* Important: Hides the content during transition */
    
    /* The transition property makes the animation smooth */
    transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out; 
}

/* New class added by JavaScript to show the content */
.box-container.active {
    /* Set max-height large enough to fit all content */
    max-height: 500px; 
    opacity: 1;
}

/* All other styles remain the same... */
.box {
    background:white;
    padding:40px;
    border-radius:12px;
    box-shadow:0 4px 20px rgba(0,0,0,0.2);
    text-align:center;
    width:300px;
    margin: 0 auto;
}


/* Existing styles for form elements */
input {width:100%;padding:12px;margin:15px 0;font-size:18px;border:1px solid #ccc;border-radius:8px;}
button {width:100%;padding:14px;background:#3b6dc6;color:white;border:none;border-radius:8px;font-size:18px;cursor:pointer;}
.wrong {color:red;margin-top:10px;display:none;}

  </style>
</head>
<body>
  <main class="page">
   <button id="studio-toggle-btn" class="toggle-btn">Studio</button>

<div id="studio-content" class="box-container">
    <div class="box">
        <h2>Studio Access</h2>
        <input type="password" id="pass" placeholder="Enter password" />
        <button onclick="go()">Enter Studio</button>
        <p class="wrong" id="msg">Wrong password!</p>
    </div>
</div>
    <h1>Current Stock</h1>
    <section id="productsContainer" class="products-area">
      <div class="hint">Loading products...</div>
    </section>

    
  </main>





  <!-- PWA Install Button (optional) -->
 <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }

  let deferredPrompt;
  const INSTALL_KEY = "appInstalledOrDismissed"; // Remember user's choice forever

  // Check if user already installed or dismissed
  if (localStorage.getItem(INSTALL_KEY) === "true") {
    // Do nothing — button stays hidden forever
  } else {
    // Create tiny install button at top-right
    const btn = document.createElement("button");
    btn.textContent = "↓ Install";
    btn.title = "Install this app on your device";
    btn.style = `
      position:fixed;
      top:15px;
      right:15px;
      background:#3b6dc6;
      color:white;
      border:none;
      padding:6px 10px;
      font-size:12px;
      border-radius:20px;
      cursor:pointer;
      z-index:9999;
      box-shadow:0 2px 10px rgba(0,0,0,0.2);
      transition:all 0.3s ease;
      display:none;
    `;
    btn.onmouseover = () => btn.style.transform = "scale(1.1)";
    btn.onmouseout  = () => btn.style.transform = "scale(1)";

    document.body.appendChild(btn);

    window.addEventListener("beforeinstallprompt", e => {
      e.preventDefault();
      deferredPrompt = e;
      btn.style.display = "block"; // Show only when installable
    });

    btn.onclick = () => {
      btn.style.display = "none";
      localStorage.setItem(INSTALL_KEY, "true"); // Never show again

      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(choice => {
          if (choice.outcome === "accepted") {
            console.log("App installed");
          } else {
            console.log("Install declined");
          }
          deferredPrompt = null;
        });
      }
    };

    // Optional: Also hide forever if user clicks outside (dismisses prompt)
    window.addEventListener("appinstalled", () => {
      localStorage.setItem(INSTALL_KEY, "true");
    });
  }
</script>

<script>
    // ===================================================================
    // Constants
    // ===================================================================
    const PASSWORD = "12345";
    const AUTH_KEY = "studioAuthenticated";      // Permanent access granted
    const BAN_KEY  = "studioAccessBanned";       // Permanent ban
    const UNBAN_CODE = "LIFTBAN";                // Secret unban code

    // Persistent counters (survive page reloads and sessions)
    let successfulLogins = parseInt(localStorage.getItem('studioSuccessCount') || '0', 10);
    let failedLogins     = parseInt(localStorage.getItem('studioFailedCount') || '0', 10);

    // ===================================================================
    // 1. On Page Load – Initial checks
    // ===================================================================
    document.addEventListener('DOMContentLoaded', () => {
        const toggleBtn = document.getElementById('studio-toggle-btn');
        const content   = document.getElementById('studio-content');

        // Permanently banned?
        if (localStorage.getItem(BAN_KEY) === 'true') {
            toggleBtn.style.display = 'none';
            return;
        }

        // Already authenticated forever?
        if (localStorage.getItem(AUTH_KEY) === 'true') {
            toggleBtn.textContent = "Studio (Direct Access)";
            content.remove(); // Completely remove the password box from DOM
        }
    });

    // ===================================================================
    // 2. Toggle Button Click
    // ===================================================================
    document.getElementById('studio-toggle-btn').addEventListener('click', function () {
        const content   = document.getElementById('studio-content');
        const toggleBtn = this;

        // Ban check again (in case it was set elsewhere)
        if (localStorage.getItem(BAN_KEY) === 'true') {
            toggleBtn.style.display = 'none';
            return;
        }

        // If already permanently authenticated → go straight to studio
        if (localStorage.getItem(AUTH_KEY) === 'true') {
            location.href = "studio.html";
            return;
        }

        // Otherwise show/hide the password box
        content.classList.toggle('active');

        if (!content.classList.contains('active')) {
            document.getElementById('msg').style.display = 'none';
        }
    });

    // ===================================================================
    // 3. Password Check Function
    // ===================================================================
    function go() {
        const inputPass  = document.getElementById('pass').value.trim();
        const msgElement = document.getElementById('msg');
        const toggleBtn  = document.getElementById('studio-toggle-btn');
        const content    = document.getElementById('studio-content');

        // === Unban secret code ===
        if (inputPass === UNBAN_CODE) {
            localStorage.removeItem(BAN_KEY);
            localStorage.setItem('studioFailedCount', '0');
            failedLogins = 0;

            toggleBtn.style.display = 'block';
            content.classList.remove('active');
            content.style.display = '';

            msgElement.textContent = "Ban lifted! You may now log in normally.";
            msgElement.style.color = "blue";
            msgElement.style.display = "block";
            return;
        }

        // === Correct password ===
        if (inputPass === PASSWORD) {
            successfulLogins++;
            failedLogins = 0;

            localStorage.setItem('studioSuccessCount', successfulLogins);
            localStorage.setItem('studioFailedCount', '0');

            if (successfulLogins >= 2) {
                // Permanent access granted!
                localStorage.setItem(AUTH_KEY, 'true');
                toggleBtn.textContent = "Studio (Direct Access)";

                // Permanently remove the entire password box
                content.remove();

                msgElement.textContent = "Password remembered forever! Redirecting...";
                msgElement.style.color = "green";
                msgElement.style.display = "block";
            }

            setTimeout(() => location.href = "studio.html", 150);

        // === Wrong password ===
        } else {
            successfulLogins = 0;
            failedLogins++;

            localStorage.setItem('studioSuccessCount', '0');
            localStorage.setItem('studioFailedCount', failedLogins);

            if (failedLogins >= 2) {
                localStorage.setItem(BAN_KEY, 'true');

                msgElement.textContent = "Too many wrong attempts → Access permanently banned.";
                msgElement.style.color = "red";
                msgElement.style.display = "block";

                content.classList.remove('active');

                setTimeout(() => toggleBtn.style.display = 'none', 600);
            } else {
                msgElement.textContent = `Wrong password! ${2 - failedLogins} attempt(s) left before permanent ban.`;
                msgElement.style.color = "red";
                msgElement.style.display = "block";
            }
        }
    }

    // ===================================================================
    // 4. Enter key support
    // ===================================================================
    document.getElementById('pass')?.addEventListener('keypress', e => {
        if (e.key === 'Enter') go();
    });
</script>
  <script src="index.js" defer></script>
</body>
</html>